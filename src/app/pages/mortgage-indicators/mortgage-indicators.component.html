<app-extra-header class="flex -mt-32 relative text-white text-center">
  <div class="h-60 flex flex-col justify-center" id="logo-side">
    <h1 class="text-3xl sm:text-4xl md:text-5xl font-semibold">{{ lang.map.qatar_real_estate_platform }}</h1>
    <h2 class="text-xl sm:text-2xl md:text-3xl font-semibold">
      {{ lang.toggleMap.qatar_real_estate_platform }} -
      <span class="text-gray-400 font-normal">({{ lang.map.trial_run }})</span>
    </h2>
    <h2 class="text-xl sm:text-2xl md:text-3xl font-semibold flex flex-col gap-3 items-center">
      <span class="text-secondary">{{ lang.map.real_estate_mortgage_indicators }}</span>
    </h2>
  </div>
</app-extra-header>
<div class="content-wrapper">
  <div class="p-3 lg:px-16">
    <app-transactions-filter
      indicatorType="mortgage"
      [municipalities]="municipalities"
      (fromChanged)="filterChange($event)"
      [areas]="areas"
      [propertyTypes]="propertyTypes"
      [propertyUsages]="propertyUsage"
      [paramsRange]="paramsRange" />
  </div>

  <div class="flex flex-col">
    <div class="py-16 px-3 lg:px-16">
      <div class="flex flex-col">
        <h3
          class="heading text-xl sm:text-2xl md:text-3xl self-center md:self-start text-center text-primary border-secondary font-semibold">
          {{ lang.map.mortgage_transactions_measuring_dashboard }}
        </h3>
        <div
          class="flex-1 my-4 p-4 border border-secondary rounded-lg grid grid-cols-1 md:grid-cols-3 justify-center gap-4">
          <app-kpi-root *ngFor="let item of rootKpis" [item]="item" />
        </div>
      </div>
    </div>
    <div class="flex flex-col p-3 lg:px-16">
      <h3
        class="heading text-xl sm:text-2xl md:text-3xl self-center md:self-start text-center text-primary border-secondary font-semibold">
        {{ lang.map.total_mortgage_transactions }}
      </h3>
      <div class="mt-4 flex justify-center md:justify-end">
        <div class="grid grid-cols-4 gap-2">
          <app-button
            size="sm"
            (click)="updateCountChartData(DurationTypes.YEARLY)"
            [buttonStyle]="selectedCountChartDurationType === DurationTypes.YEARLY ? 'secondary' : 'secondary-outline'"
            [isRounded]="true"
            >{{ lang.map.yearly }}</app-button
          >
          <app-button
            size="sm"
            (click)="updateCountChartData(DurationTypes.HALFY)"
            [buttonStyle]="selectedCountChartDurationType === DurationTypes.HALFY ? 'secondary' : 'secondary-outline'"
            [isRounded]="true"
            >{{ lang.map.half_yearly }}</app-button
          >
          <app-button
            size="sm"
            (click)="updateCountChartData(DurationTypes.QUARTERLY)"
            [buttonStyle]="
              selectedCountChartDurationType === DurationTypes.QUARTERLY ? 'secondary' : 'secondary-outline'
            "
            [isRounded]="true"
            >{{ lang.map.quarter_yearly }}</app-button
          >
          <app-button
            size="sm"
            (click)="updateCountChartData(DurationTypes.MONTHLY)"
            [buttonStyle]="selectedCountChartDurationType === DurationTypes.MONTHLY ? 'secondary' : 'secondary-outline'"
            [isRounded]="true"
            >{{ lang.map.monthly }}</app-button
          >
        </div>
      </div>
      <div class="flex flex-col mt-2 md:flex-row">
        <div class="flex-auto overflow-hidden pt-1" dir="ltr">
          <apx-chart
            #countChart
            class="custom-toolbar [&>div]:ml-[-22px]"
            [series]="countChartOptions.series!"
            [chart]="countChartOptions.chart!"
            [xaxis]="countChartOptions.xaxis!"
            [stroke]="countChartOptions.stroke!"
            [colors]="countChartOptions.colors!"
            [dataLabels]="countChartOptions.dataLabels!"
            [legend]="countChartOptions.legend!"
            [markers]="countChartOptions.markers!"
            [grid]="countChartOptions.grid!"
            [yaxis]="countChartOptions.yaxis!"
            [tooltip]="countChartOptions.tooltip!"
            [plotOptions]="countChartOptions.plotOptions!"
            [title]="countChartOptions.title!" />
        </div>
        <div class="h-full flex flex-row justify-center md:flex-col -mt-6 md:mt-4">
          <app-icon-button
            [ngClass]="{ 'text-primary': selectedCountChartType === ChartType.LINE }"
            (click)="updateCountChartType(ChartType.LINE)"
            class="text-primary"
            icon="LINE_CHART" />
          <app-icon-button
            [ngClass]="{ 'text-primary': selectedCountChartType === ChartType.BAR }"
            (click)="updateCountChartType(ChartType.BAR)"
            icon="BAR_CHART" />
          <app-icon-button
            [ngClass]="{ 'text-primary': selectedCountChartType === ChartType.AREA }"
            (click)="updateCountChartType(ChartType.AREA)"
            icon="AREA_CHART" />
        </div>
      </div>
    </div>
    <div class="flex flex-col mt-4 px-3 lg:px-16">
      <app-duration-chart
        [title]="lang.map.the_total_number_of_mortgaged_units"
        [name]="lang.map.number_of_units"
        [filterCriteria$]="criteria$"
        [rootData$]="unitsRootData$"></app-duration-chart>
    </div>
    <div class="flex flex-col mt-4 px-3 lg:px-16">
      <app-duration-chart
        [title]="lang.map.total_value_of_mortgage_transactions"
        [name]="lang.map.transactions_value"
        [filterCriteria$]="criteria$"
        [rootData$]="valueRootData$"></app-duration-chart>
    </div>
    <div class="px-3 lg:px-16 flex flex-col gap-4">
      <h3
        class="heading text-xl sm:text-2xl md:text-3xl self-center md:self-start text-center text-primary border-secondary font-semibold">
        {{ lang.map.mortgage_transactions_list }}
      </h3>
      <app-table
        minWidth="900px"
        headerBgColor="!bg-secondary"
        (paginate)="paginate($event)"
        [length]="transactionsCount"
        [dataSource]="dataSource"
        [sortOptions]="[]"
        [defaultSortOption]="transactionsSortOptions[0]">
        <ng-container appTableColumnTemplate columnName="location">
          <div *appTableColumnHeaderTemplate class="flex justify-center">
            <div class="text-start">
              <p>{{ lang.map.location }}</p>
              <p class="font-normal">{{ lang.map.real_estate_status }}</p>
            </div>
          </div>
          <div *appTableColumnCellTemplate="let item; typeOf: transactions$" class="flex justify-center">
            <div class="text-start">
              <p class="font-bold">{{ item.municipalityInfo.getNames() }}</p>
              <p>{{ item.areaInfo && item.areaInfo.getNames() && "---" }}</p>
            </div>
          </div>
        </ng-container>
        <ng-container appTableColumnTemplate columnName="mortgaged_for">
          <span *appTableColumnHeaderTemplate>{{ lang.map.mortgaged_for }}</span>
          <span *appTableColumnCellTemplate="let item; typeOf: transactions$" class="font-bold">{{
            item.realEstateValue | number
          }}</span>
        </ng-container>
        <ng-container appTableColumnTemplate columnName="area_in_square_feet">
          <span *appTableColumnHeaderTemplate>{{ lang.map.area_in_square_foot }}</span>
          <span *appTableColumnCellTemplate="let item; typeOf: transactions$" class="font-bold">---</span>
        </ng-container>
        <!-- <ng-container appTableColumnTemplate columnName="square_feet_price">
            <span *appTableColumnHeaderTemplate>{{ lang.map.square_feet_price }}</span>
            <span *appTableColumnCellTemplate="let item; typeOf: transactions" class="font-bold">{{
              item.priceMT | number : "1.0-0"
            }}</span>
          </ng-container> -->
        <ng-container appTableColumnTemplate columnName="issue_date">
          <div *appTableColumnHeaderTemplate class="flex justify-center">
            <div class="text-start">
              <p>{{ lang.map.issue_date }}</p>
              <!--                <p class="font-normal">{{ lang.map.sold_by }}</p>-->
            </div>
          </div>
          <div *appTableColumnCellTemplate="let item; typeOf: transactions$" class="text-center">
            <p>{{ item.issueDate | date : "YYYY-MM-dd" }}</p>
            <p class="font-bold">{{ item.seller || "أفراد" }}</p>
          </div>
        </ng-container>
        <!--          <ng-container appTableColumnTemplate columnName="unit_parcel_no">-->
        <!--            <span *appTableColumnHeaderTemplate>{{ lang.map.unit_parcel_no }}</span>-->
        <!--            <span *appTableColumnCellTemplate="let item; typeOf: transactions$" class="font-bold">{{-->
        <!--              item.unitNo | number-->
        <!--            }}</span>-->
        <!--          </ng-container>-->
        <!-- <ng-template appTableColumnTemplate columnName="area" [columnHeader]="lang.map.area" >
            <span class="font-bold">{{ item.area === null ? "---" : (item.area | number ) }}</span>
          </ng-template> -->
        <!-- <ng-template
            appTableColumnTemplate
            columnName="unit_parcel_no"
            [columnHeader]="lang.map.unit_parcel_no"
            let-item
            ><span class="font-bold">{{ item.unitNo ?? 13000 | number }}</span></ng-template
          > -->
      </app-table>
    </div>
  </div>
</div>
